<!DOCTYPE html>
<html>
<head>
  <title>DigitoPay Webhook API</title>
</head>
<body>
  <script>
    // API Route para webhook do DigitoPay
    // Redireciona para a Supabase Edge Function
    
    async function handleWebhook() {
      try {
        // Pegar dados do webhook
        const webhookData = await new Promise((resolve) => {
          let data = '';
          process.stdin.on('data', chunk => {
            data += chunk;
          });
          process.stdin.on('end', () => {
            resolve(JSON.parse(data));
          });
        });

        // Enviar para Supabase Edge Function
        const response = await fetch('https://cbwpghrkfvczjqzefvix.supabase.co/functions/v1/digitopay-deposit-webhook', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNid3BnaHJrZnZjempxemVmdml4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3MTM4ODMsImV4cCI6MjA2ODI4OTg4M30.DxGYGfC1Ge589yiPCQuC8EyMD_ium4NOpD8coYAtYz8'
          },
          body: JSON.stringify(webhookData)
        });

        const result = await response.json();
        
        // Retornar resposta
        console.log(JSON.stringify({
          success: true,
          message: 'Webhook processado com sucesso',
          data: result
        }));
        
      } catch (error) {
        console.error('Erro no webhook:', error);
        console.log(JSON.stringify({
          success: false,
          message: 'Erro ao processar webhook',
          error: error.message
        }));
      }
    }

    // Executar se for chamado via Node.js
    if (typeof process !== 'undefined') {
      handleWebhook();
    }
  </script>
  
  <div>
    <h1>DigitoPay Webhook API</h1>
    <p>Esta API redireciona webhooks do DigitoPay para a Supabase Edge Function.</p>
    <p>Status: <span id="status">Aguardando...</span></p>
  </div>

  <script>
    // Para requisições via navegador
    if (typeof window !== 'undefined') {
      document.getElementById('status').textContent = 'API Disponível';
    }
  </script>
</body>
</html>
